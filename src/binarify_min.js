!function(){var s={byte:256,short:65536,tribyte:16777216,int:4294967296,float:16777217,double:Number.MAX_SAFE_INTEGER},e=["byte","short","tribyte","int","float","double"],r=["uByte","sByte","uShort","sShort","uTribyte","sTribyte","uInt","sInt","float","double"];function d(t){switch(t){case"byte":return 1;case"short":return 2;case"tribyte":return 3;case"int":case"float":return 4;case"double":return 8;default:throw new Error("Incorrect number type '"+t+"'")}}function c(t){switch(t){case 1:return"byte";case 2:return"short";case 3:return"tribyte";case 4:return"int";default:return"double"}}function n(t,r){return(t%r+r)%r}var o=/^[0-9a-fA-F]+$/;var l=0,t={version:"2.4.1",Boolean:function(){this.set=function(){return this},this.encode=function(t){return t?"":"\0"},this.decode=function(t,r){return!0!==r&&(l=0),1===t.charCodeAt(l++)}},Number:function(n){var o;this.set=function(t){if(n=t||"double",-1===r.indexOf(n))throw new Error("Incorrect Number type '"+n+"'");return o=d(("double"!==n&&"float"!==n?n.slice(1):n).toLowerCase()),this},this.set(n),this.encode=function(t){return g.to[n](t)},this.decode=function(t,r){!0!==r&&(l=0);var e=g.from[n](t.substr(l,o));return l+=o,e}},String:function(r){var i,h,a;this.set=function(t){if(i="number"==typeof(r=t)){if((r=Math.floor(r))<0)throw new Error("String cannot have a fixed length shorter than 0");a=r}else if("nullTer"!==(h=r||"nullTer")&&-1===e.indexOf(h))throw new Error("Incorrect String size number type '"+h+"'");return this},this.set(r),this.encode=function(t){if(i){if(t.length===a)return t;throw new Error("Passed string isn't of specified length "+a)}return"nullTer"===h?(-1!==t.indexOf("\0")&&t.replace(/\u0000/g," "),t+"\0"):(t=t.slice(0,s[h]-1),g.to[h](t.length)+t)},this.decode=function(t,r){var e;if(!0!==r&&(l=0),i)e=t.substr(l,a),l+=a;else if("nullTer"===h)e=t.slice(l,t.indexOf("\0",l)),l+=e.length+1;else{var n=d(h),o=g.from[h](t.substr(l,n));e=t.substr(l+n,o),l+=n+o}return e}},HexString:function(f){var u;this.set=function(t){if((u="number"==typeof(f=t))&&(f=Math.floor(f))<0)throw new Error("HexString cannot have a fixed length shorter than 0");return this},this.set(f),this.encode=function(t){if(r=t,!o.test(r))throw new Error("Passed string is not a HexString!");var r;if(u&&t.length!==f)throw new Error("Passed string isn't of specified length "+f);var e="";u||(e+=String.fromCharCode(t.length%2==0?1:0));for(var n=0;n<t.length;n+=2)e+=String.fromCharCode(parseInt(t.substr(n,2<=t.length-n?2:1),16));return u||(e+="Ā"),e},this.decode=function(t,r){var e;if(!0!==r&&(l=0),u)e=t.substr(l,Math.ceil(f/2));else{var n=1===t.charCodeAt(l),o=t.indexOf("Ā",l);e=t.slice(l+1,o)}for(var i="",h=0;h<e.length;h++)if(h!==e.length-1)i+=("00"+e.charCodeAt(h).toString(16)).slice(-2);else{var a=!1;u||n||(a=!0),u&&f%2==1&&(a=!0),i+=a?e.charCodeAt(h).toString(16):("00"+e.charCodeAt(h).toString(16)).slice(-2)}return l+=e.length+(u?0:2),i}},Object:function(h,a){var f,u,s;this.set=function(t,r){if(a=r,void 0!==(h=t))return(f=Object.keys(h)).sort(),a&&(u=Math.ceil(Math.log2(f.length)/8)||1,s=c(u),u=d(s)),this},this.set(h,a),this.encode=function(t){if(void 0===h)throw new Error("Can't encode, no blueprint defined");var r="";if(a){var e=0;for(var n in t)void 0!==h[n]&&(r+=g.to[s](f.indexOf(n))+h[n].encode(t[n]),e++);r=g.to[s](e)+r}else for(var o=0;o<f.length;o++){if(void 0===t[n=f[o]])throw new Error("Key '"+n+"' is defined in the blueprint, but not in the input object");r+=h[n].encode(t[n])}return r},this.decode=function(t,r){!0!==r&&(l=0);var e={};if(a){var n=g.from[s](t.substr(l,u));l+=u;for(o=0;o<n;o++){i=f[g.from[s](t.substr(l,u))];l+=u,e[i]=h[i].decode(t,!0)}}else for(var o=0;o<f.length;o++){var i;e[i=f[o]]=h[i].decode(t,!0)}return e}},Array:function(h,a){var f,u;this.set=function(t,r){if(a=r,void 0!==(h=t)){if(void 0!==a)if(f="number"==typeof a){if((a=Math.floor(a))<0)throw new Error("Array cannot have a fixed length shorter than 0")}else{if(!(-1<e.indexOf(a)))throw new Error("Incorrect Array size number type '"+a+"'");u=d(a)}return this}},this.set(h,a),this.encode=function(t){if(void 0===h)throw new Error("Can't encode, no pattern defined");if(h.length&&t.length%h.length!=0)throw new Error("Array (length "+t.length+") contains at least one incomplete pattern");var r="";if(void 0!==a){if(f){if(t.length!==a*h.length)throw new Error("Array pattern in the input isn't repeated exactly "+a+" times, as was specified")}else t=t.slice(0,(s[a]-1)*h.length);var e=Math.ceil(t.length/h.length);e!=e&&(e=0);for(var n=0;n<e;n++)for(var o=0;o<h.length;o++)r+=h[o].encode(t[n*h.length+o]);f||(r=g.to[a](e)+r)}else{if(t.length<h.length)throw new Error("Input array (length "+t.length+") has to be at least as long as the pattern array (length "+h.length+")");for(n=0;n<h.length;n++)r+=h[n].encode(t[n])}return r},this.decode=function(t,r){!0!==r&&(l=0);var e=[];if(void 0!==a){var n;f?n=a:(n=g.from[a](t.substr(l,u)),l+=u);for(var o=0;o<n;o++)for(var i=0;i<h.length;i++)e[o*h.length+i]=h[i].decode(t,!0)}else for(o=0;o<h.length;o++)e[o]=h[o].decode(t,!0);return e}},Dynamic:function(o){var i,n,h;this.set=function(t){if(void 0!==(o=t))return(i=Object.keys(o)).sort(),n=Math.ceil(Math.log2(i.length)/8)||1,h=c(n),n=d(h),this},this.set(o),this.encode=function(t,r){if(void 0===o)throw new Error("Can't encode, no pairs object defined");var e,n;if(void 0!==r?(e=t,n=r):(e=t.key,n=t.value),void 0===o[e])throw new Error("Key '"+e+"' is not defined");return g.to[h](i.indexOf(e))+(null===o[e]?"":o[e].encode(n))},this.decode=function(t,r){!0!==r&&(l=0);var e=i[g.from[h](t.substr(l,n))];return l+=n,{key:e,value:null===o[e]?null:o[e].decode(t,!0)}}},SetElement:function(o,i){var h,a,f,u;this.set=function(t,r){if(i=r,void 0!==(o=t)){if(!i){h={},a=[];for(var e=0;e<o.length;e++)try{var n=JSON.stringify(o[e]);if(void 0===n)throw new Error("Element "+o[e]+" serialized to 'undefined', thaz' bad.");h[n]=e,a.push(n)}catch(t){throw new Error("Set element "+o[e]+" couldn't be serialized",t)}}return f=Math.ceil(Math.log2(o.length)/8)||1,u=c(f),f=d(u),this}},this.set(o,i),this.encode=function(t){if(void 0===o)throw new Error("Can't encode, no element array defined");var r;if(-1!==(r=i?o.indexOf(t):h[JSON.stringify(t)])&&void 0!==r)return g.to[u](r);throw new Error("Element "+t+" not specified in Set")},this.decode=function(t,r){!0!==r&&(l=0);var e=g.from[u](t.substr(l,f));return l+=f,i?o[e]:JSON.parse(a[e])}},BitField:function(h){this.set=function(t){return h=t,this},this.encode=function(t){if(void 0===h)throw new Error("Can't encode, no attribute array defined");for(var r="",e=0,n=0;n<h.length;n++){n%8==0&&0<n&&(r+=String.fromCharCode(e),e=0);var o=h[n];if(void 0===t[o])throw new Error("Attribute '"+o+"' is defined in the BitField, but wasn't passed to it in its encode method");!0===t[o]&&(e+=Math.pow(2,n%8))}return h.length&&(r+=String.fromCharCode(e)),r},this.decode=function(t,r){!0!==r&&(l=0);for(var e={},n=0,o=t.charCodeAt(l),i=0;i<h.length;i++)i%8==0&&0<i&&(n++,o=t.charCodeAt(l+n)),e[h[i]]=0<(o&Math.pow(2,i%8));return l+=Math.floor(h.length/8),e}},NullWrapper:function(e){this.set=function(t){return e=t,this},this.encode=function(t){return null===t||void 0===e?"\0":""+e.encode(t)},this.decode=function(t,r){return!0!==r&&(l=0),0===t.charCodeAt(l++)?null:e.decode(t,!0)}}},i=new ArrayBuffer(8),h=new Uint8Array(i),a=new Float32Array(i),f=new Float64Array(i),g={to:{uByte:function(t){return t=n(Math.round(t),s.byte),String.fromCharCode(t)},uShort:function(t){return t=n(Math.round(t),s.short),String.fromCharCode(Math.floor(t/s.byte))+String.fromCharCode(t%s.byte)},uTribyte:function(t){return t=n(Math.round(t),s.tribyte),String.fromCharCode(Math.floor(t/s.short))+String.fromCharCode(Math.floor(t%s.short/s.byte))+String.fromCharCode(t%s.byte)},uInt:function(t){return t=n(Math.round(t),s.int),String.fromCharCode(Math.floor(t/s.tribyte))+String.fromCharCode(Math.floor(t%s.tribyte/s.short))+String.fromCharCode(Math.floor(t%s.short/s.byte))+String.fromCharCode(t%s.byte)},sByte:function(t){return this.uByte(t+s.byte/2)},sShort:function(t){return this.uShort(t+s.short/2)},sTribyte:function(t){return this.uTribyte(t+s.tribyte/2)},sInt:function(t){return this.uInt(t+s.int/2)},float:function(t){return a[0]=t,String.fromCharCode(h[0])+String.fromCharCode(h[1])+String.fromCharCode(h[2])+String.fromCharCode(h[3])},double:function(t){return f[0]=t,String.fromCharCode(h[0])+String.fromCharCode(h[1])+String.fromCharCode(h[2])+String.fromCharCode(h[3])+String.fromCharCode(h[4])+String.fromCharCode(h[5])+String.fromCharCode(h[6])+String.fromCharCode(h[7])}},from:{uByte:function(t){return n(t.charCodeAt(0),s.byte)},uShort:function(t){return n(t.charCodeAt(0)*s.byte+t.charCodeAt(1),s.short)},uTribyte:function(t){return n(t.charCodeAt(0)*s.short+t.charCodeAt(1)*s.byte+t.charCodeAt(2),s.tribyte)},uInt:function(t){return n(t.charCodeAt(0)*s.tribyte+t.charCodeAt(1)*s.short+t.charCodeAt(2)*s.byte+t.charCodeAt(3),s.int)},sByte:function(t){return this.uByte(t)-s.byte/2},sShort:function(t){return this.uShort(t)-s.short/2},sTribyte:function(t){return this.uTribyte(t)-s.tribyte/2},sInt:function(t){return this.uInt(t)-s.int/2},float:function(t){return h[0]=t.charCodeAt(0),h[1]=t.charCodeAt(1),h[2]=t.charCodeAt(2),h[3]=t.charCodeAt(3),a[0]},double:function(t){return h[0]=t.charCodeAt(0),h[1]=t.charCodeAt(1),h[2]=t.charCodeAt(2),h[3]=t.charCodeAt(3),h[4]=t.charCodeAt(4),h[5]=t.charCodeAt(5),h[6]=t.charCodeAt(6),h[7]=t.charCodeAt(7),f[0]}}};g.to.byte=g.to.uByte,g.to.short=g.to.uShort,g.to.tribyte=g.to.uTribyte,g.to.int=g.to.uInt,g.from.byte=g.from.uByte,g.from.short=g.from.uShort,g.from.tribyte=g.from.uTribyte,g.from.int=g.from.uInt,"object"==typeof module&&"object"==typeof module.exports?module.exports=t:"undefined"!=typeof window?window.Binarify=t:this.Binarify=t}();