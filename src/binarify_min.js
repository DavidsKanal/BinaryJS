!function(){var c={byte:256,short:65536,tribyte:16777216,int:4294967296,float:16777217,double:Number.MAX_SAFE_INTEGER},r=["byte","short","tribyte","int","float","double"],t=["uByte","sByte","uShort","sShort","uTribyte","sTribyte","uInt","sInt","float","double"];function d(t){switch(t){case"byte":return 1;case"short":return 2;case"tribyte":return 3;case"int":case"float":return 4;case"double":return 8;default:throw new Error("Incorrect number type '"+t+"'")}}function s(t){switch(t){case 1:return"byte";case 2:return"short";case 3:return"tribyte";case 4:return"int";default:return"double"}}function e(t,r){return(t%r+r)%r}var o=/^[0-9a-fA-F]+$/;var l=0,n={version:"2.2.0",Boolean:function(){this.encode=function(t){return t?"":"\0"},this.decode=function(t,r){return!0!==r&&(l=0),1===t.charCodeAt(l++)}},Number:function(n){if(n=n||"double",-1===t.indexOf(n))throw new Error("Incorrect Number type '"+n+"'");var o=d(("double"!==n&&"float"!==n?n.slice(1):n).toLowerCase());this.encode=function(t){return C.to[n](t)},this.decode=function(t,r){!0!==r&&(l=0);var e=C.from[n](t.substr(l,o));return l+=o,e}},String:function(t){var i="number"==typeof t;if(i){if((t=Math.floor(t))<0)throw new Error("String cannot have a fixed length shorter than 0");var a=t}else{var h=t||"nullTer";if("nullTer"!==h&&-1===r.indexOf(h))throw new Error("Incorrect String size number type '"+h+"'")}this.encode=function(t){if(i){if(t.length===a)return t;throw new Error("Passed string isn't of specified length "+a+"!")}return"nullTer"===h?(-1!==t.indexOf("\0")&&t.replace(/\u0000/g," "),t+"\0"):(t=t.slice(0,c[h]-1),C.to[h](t.length)+t)},this.decode=function(t,r){var e;if(!0!==r&&(l=0),i)e=t.substr(l,a),l+=a;else if("nullTer"===h)e=t.slice(l,t.indexOf("\0",l)),l+=e.length+1;else{var n=d(h),o=C.from[h](t.substr(l,n));e=t.substr(l+n,o),l+=n+o}return e}},HexString:function(u){var f="number"==typeof u;if(f&&(u=Math.floor(u))<0)throw new Error("HexString cannot have a fixed length shorter than 0");this.encode=function(t){if(r=t,!o.test(r))throw new Error("Passed string is not a HexString!");var r;if(f&&t.length!==u)throw new Error("Passed string isn't of specified length "+u+"!");var e="";f||(e+=String.fromCharCode(t.length%2==0?1:0));for(var n=0;n<t.length;n+=2)e+=String.fromCharCode(parseInt(t.substr(n,2<=t.length-n?2:1),16));return f||(e+="Ā"),e},this.decode=function(t,r){var e;if(!0!==r&&(l=0),f)e=t.substr(l,Math.ceil(u/2));else{var n=1===t.charCodeAt(l),o=t.indexOf("Ā",l);e=t.slice(l+1,o)}for(var i="",a=0;a<e.length;a++)if(a!==e.length-1)i+=("00"+e.charCodeAt(a).toString(16)).slice(-2);else{var h=!1;f||n||(h=!0),f&&u%2==1&&(h=!0),i+=h?e.charCodeAt(a).toString(16):("00"+e.charCodeAt(a).toString(16)).slice(-2)}return l+=e.length+(f?0:2),i}},Object:function(a,h){if(void 0===a)throw new Error("Can't instanciate Object without a blueprint!");var u=Object.keys(a);if(u.sort(),h){var f=Math.ceil(Math.log2(u.length)/8)||1,c=s(f);f=d(c)}this.encode=function(t){var r="";if(h){var e=0;for(var n in t)void 0!==a[n]&&(r+=C.to[c](u.indexOf(n))+a[n].encode(t[n]),e++);r=C.to[c](e)+r}else for(var o=0;o<u.length;o++){if(void 0===t[n=u[o]])throw new Error("Key '"+n+"' is defined in the blueprint, but not in the input object!");r+=a[n].encode(t[n])}return r},this.decode=function(t,r){!0!==r&&(l=0);var e={};if(h){var n=C.from[c](t.substr(l,f));l+=f;for(o=0;o<n;o++){i=u[C.from[c](t.substr(l,f))];l+=f,e[i]=a[i].decode(t,!0)}}else for(var o=0;o<u.length;o++){var i;e[i=u[o]]=a[i].decode(t,!0)}return e}},Array:function(a,h){if(void 0===a)throw new Error("Can't instanciate Array without a pattern!");if(void 0!==h){var u="number"==typeof h;if(u){if((h=Math.floor(h))<0)throw new Error("Array cannot have a fixed length shorter than 0")}else{if(!(-1<r.indexOf(h)))throw new Error("Incorrect Array size number type '"+h+"'");var f=d(h)}}this.encode=function(t){if(t.length%a.length!=0)throw new Error("Array (length "+t.length+") contains at least one incomplete pattern!");var r="";if(void 0!==h){if(u){if(t.length!==h*a.length)throw new Error("Array pattern in the input isn't repeated exactly "+h+" times, as was specified")}else t=t.slice(0,(c[h]-1)*a.length);for(var e=Math.ceil(t.length/a.length),n=0;n<e;n++)for(var o=0;o<a.length;o++)r+=a[o].encode(t[n*a.length+o]);u||(r=C.to[h](e)+r)}else for(n=0;n<a.length;n++)r+=a[n].encode(t[n]);return r},this.decode=function(t,r){!0!==r&&(l=0);var e=[];if(h){var n;u?n=h:(n=C.from[h](t.substr(l,f)),l+=f);for(var o=0;o<n;o++)for(var i=0;i<a.length;i++)e[o*a.length+i]=a[i].decode(t,!0)}else for(o=0;o<a.length;o++)e[o]=a[o].decode(t,!0);return e}},Dynamic:function(o){if(void 0===o)throw new Error("Can't instanciate Dynamic without a pair object!");var i=Object.keys(o);i.sort();var n=Math.ceil(Math.log2(i.length)/8)||1,a=s(n);n=d(a),this.encode=function(t,r){var e,n;if(void 0!==r?(e=t,n=r):(e=t.key,n=t.value),void 0===o[e])throw new Error("Key '"+e+"' is not defined!");return C.to[a](i.indexOf(e))+(null===o[e]?"":o[e].encode(n))},this.decode=function(t,r){!0!==r&&(l=0);var e=i[C.from[a](t.slice(l,n))];return l+=n,{key:e,value:null===o[e]?null:o[e].decode(t,!0)}}},SetElement:function(n){if(void 0===n)throw new Error("Can't instanciate SetElement without an array of elements!");for(var e={},r=0;r<n.length;r++)try{e[JSON.stringify(n[r])]=r}catch(t){throw new Error("Set element "+n[r]+" couldn't be serialized.",t)}var o=Math.ceil(Math.log2(n.length)/8)||1,i=s(o);o=d(i),this.encode=function(t){var r=e[JSON.stringify(t)];if(void 0!==r)return C.to[i](r);throw new Error("Element "+t+" not specified in Set!")},this.decode=function(t,r){!0!==r&&(l=0);var e=C.from[i](t.substr(l,o));return l+=o,n[e]}},BitField:function(i){if(void 0===i)throw new Error("Can't instanciate BitField without an array of attributes!");this.encode=function(t){for(var r="",e=0,n=0;n<i.length;n++){0<n&&n%8==0&&(r+=String.fromCharCode(e),e=0);var o=i[n];if(void 0===t[o])throw new Error("Attribute '"+o+"' is defined in the BitField, but wasn't passed to it in its encode method!");!0===t[o]&&(e+=Math.pow(2,n%8))}return i.length&&(r+=String.fromCharCode(e)),r},this.decode=function(t){for(var r={},e=0,n=t.charCodeAt(l),o=0;o<i.length;o++)0<o&&o%8==0&&(e++,n=t.charCodeAt(l+e)),r[i[o]]=0<(n&Math.pow(2,o%8));return l+=Math.floor(i.length/8),r}},NullWrapper:function(e){if(void 0===e)throw new Error("Can't instanciate NulLWrapper without a Converter!");this.encode=function(t){return null===t?"\0":""+e.encode(t)},this.decode=function(t,r){return!0!==r&&(l=0),0===t.charCodeAt(l++)?null:e.decode(t,!0)}}},i=new ArrayBuffer(8),a=new Uint8Array(i),h=new Float32Array(i),u=new Float64Array(i),C={to:{uByte:function(t){return t=e(Math.round(t),c.byte),String.fromCharCode(t)},uShort:function(t){return t=e(Math.round(t),c.short),String.fromCharCode(Math.floor(t/c.byte))+String.fromCharCode(t%c.byte)},uTribyte:function(t){return t=e(Math.round(t),c.tribyte),String.fromCharCode(Math.floor(t/c.short))+String.fromCharCode(Math.floor(t%c.short/c.byte))+String.fromCharCode(t%c.byte)},uInt:function(t){return t=e(Math.round(t),c.int),String.fromCharCode(Math.floor(t/c.tribyte))+String.fromCharCode(Math.floor(t%c.tribyte/c.short))+String.fromCharCode(Math.floor(t%c.short/c.byte))+String.fromCharCode(t%c.byte)},sByte:function(t){return this.uByte(t+c.byte/2)},sShort:function(t){return this.uShort(t+c.short/2)},sTribyte:function(t){return this.uTribyte(t+c.tribyte/2)},sInt:function(t){return this.uInt(t+c.int/2)},float:function(t){return h[0]=t,String.fromCharCode(a[0])+String.fromCharCode(a[1])+String.fromCharCode(a[2])+String.fromCharCode(a[3])},double:function(t){return u[0]=t,String.fromCharCode(a[0])+String.fromCharCode(a[1])+String.fromCharCode(a[2])+String.fromCharCode(a[3])+String.fromCharCode(a[4])+String.fromCharCode(a[5])+String.fromCharCode(a[6])+String.fromCharCode(a[7])}},from:{uByte:function(t){return e(t.charCodeAt(0),c.byte)},uShort:function(t){return e(t.charCodeAt(0)*c.byte+t.charCodeAt(1),c.short)},uTribyte:function(t){return e(t.charCodeAt(0)*c.short+t.charCodeAt(1)*c.byte+t.charCodeAt(2),c.tribyte)},uInt:function(t){return e(t.charCodeAt(0)*c.tribyte+t.charCodeAt(1)*c.short+t.charCodeAt(2)*c.byte+t.charCodeAt(3),c.int)},sByte:function(t){return this.uByte(t)-c.byte/2},sShort:function(t){return this.uShort(t)-c.short/2},sTribyte:function(t){return this.uTribyte(t)-c.tribyte/2},sInt:function(t){return this.uInt(t)-c.int/2},float:function(t){return a[0]=t.charCodeAt(0),a[1]=t.charCodeAt(1),a[2]=t.charCodeAt(2),a[3]=t.charCodeAt(3),h[0]},double:function(t){return a[0]=t.charCodeAt(0),a[1]=t.charCodeAt(1),a[2]=t.charCodeAt(2),a[3]=t.charCodeAt(3),a[4]=t.charCodeAt(4),a[5]=t.charCodeAt(5),a[6]=t.charCodeAt(6),a[7]=t.charCodeAt(7),u[0]}}};C.to.byte=C.to.uByte,C.to.short=C.to.uShort,C.to.tribyte=C.to.uTribyte,C.to.int=C.to.uInt,C.from.byte=C.from.uByte,C.from.short=C.from.uShort,C.from.tribyte=C.from.uTribyte,C.from.int=C.from.uInt,"object"==typeof module&&"object"==typeof module.exports?module.exports=n:"undefined"!=typeof window?window.Binarify=n:this.Binarify=n}();