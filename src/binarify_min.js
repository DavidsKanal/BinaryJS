(function(){"use strict";function a(a){return 1===a?"u8":2===a?"u16":3===a?"u24":4===a?"u32":"f64"}function b(a,b){return(a%b+b)%b}function c(a){return l.test(a)}function d(a,b){for(var c=0;c<b.length;c++)a.push(b[c])}function e(a){return m.encode(a)}function f(a){return n.decode(a)}var g,h,j={u8:256,u16:65536,u24:16777216,u32:4294967296,s8:128,s16:32768,s24:8388608,s32:2147483648,f32:16777217,f64:Number.MAX_SAFE_INTEGER},k=["u8","u16","u24","u32","s8","s16","s24","s32","f32","f64"],l=/^[0-9a-fA-F]+$/;(function(a){function b(a){var b=a.charCodeAt(0)<<24,c=0|j(~b),d=0,e=0|a.length,f="";if(5>c&&e>=c){for(b=b<<c>>>24+c,d=1;d<c;d=0|d+1)b=b<<6|63&a.charCodeAt(d);65535>=b?f+=k(b):1114111>=b?(b=0|b-65536,f+=k(0|(b>>10)+55296,0|(1023&b)+56320)):d=0}for(;d<e;d=0|d+1)f+="\uFFFD";return f}function c(){}function d(a){var b=0|a.charCodeAt(0);if(55296<=b&&56319>=b){var c=0|a.charCodeAt(1);if(c!=c)return k(239,191,189);if(!(56320<=c&&57343>=c))return k(239,191,189);if(b=0|(b-55296<<10)+c-56320+65536,65535<b)return k(240|b>>>18,128|63&b>>>12,128|63&b>>>6,128|63&b)}return 127>=b?a:2047>=b?k(192|b>>>6,128|63&b):k(224|b>>>12,128|63&b>>>6,128|63&b)}function e(){}var f=Math.log,i=Math.LN2,j=Math.clz32||function(a){return 0|31-f(a>>>0)/i},k=String.fromCharCode,l={}.toString,m=a.Uint8Array,n=m||Array,o=l.call((a.ArrayBuffer||n).prototype);c.prototype.decode=function(a){var c=a&&a.buffer||a;if(l.call(c)!==o)throw Error("Failed to execute 'decode' on 'TextDecoder': The provided value is not of type '(ArrayBuffer or ArrayBufferView)'");for(var d=m?new n(c):c,e="",f=0,g=0|d.length;f<g;f=0|f+32768)e+=k.apply(0,d[m?"slice":"subarray"](f,0|f+32768));return e.replace(/[\xc0-\xff][\x80-\xbf]*/g,b)},h=c;e.prototype.encode=function(a){for(var b=void 0===a?"":(""+a).replace(/[\x80-\uD7ff\uDC00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]?/g,d),c=0|b.length,e=new n(c),f=0;f<c;f=0|f+1)e[f]=b.charCodeAt(f);return e},g=e})(typeof global=="undefined"?typeof self=="undefined"?this:self:global);var m=new g,n=new h,o=0,p=null,q=null,r={version:"3.0.0",encode:function(a,b){var c=[];return a.encode(b,c),"undefined"==typeof Buffer?new Uint8Array(c).buffer:Buffer.from(c)},decode:function(a,b){return"undefined"!=typeof Buffer&&b instanceof Buffer&&(b=b.buffer.slice(b.byteOffset,b.byteOffset+b.byteLength)),o=0,p=new Uint8Array(b),q=new DataView(b),a.decode()},Boolean:function(){this.set=function(){return this},this.encode=function(a,b){b.push(a?1:0)},this.decode=function(){return 1===p[o++]}},Number:function(a){this.set=function(b){if(a=b||"f64",-1===k.indexOf(a))throw new Error("Incorrect Number type '"+a+"'.");return this},this.set(a),this.encode=function(b,c){v.write[a](b,c)},this.decode=function(){return v.read[a]()}},String:function(a){function b(a,b){for(var c,d=0,e=0;e<b;e++){if(c=a[d],240==(240&c)){d+=4;continue}if(224==(224&c)){d+=3;continue}if(192==(192&c)){d+=2;continue}d+=1}return d}var c,g,h;this.set=function(b){if(a=b,c="number"==typeof a,!!c){if(a=Math.floor(a),0>a)throw new Error("String cannot have a fixed length shorter than 0.");h=a}else if(g=a||"nullTerminated","nullTerminated"!==g&&-1===k.indexOf(g))throw new Error("Incorrect String size number type '"+g+"'.");return this},this.set(a),this.encode=function(a,b){if(!c){if("nullTerminated"===g){-1!==a.indexOf("\0")&&a.replace(/\u0000/g," ");var f=e(a);d(b,f),b.push(0)}else a=a.slice(0,j[g]-1),v.write[g](a.length,b),b.push(...e(a));}else if(a.length===h)b.push(...e(a));else throw new Error("Passed string isn't of specified length "+h+".")},this.decode=function(){var a;if(!!c){var d=o+b(p,h),e=p.slice(o,d),i=f(e);o+=d-o,a=i}else if("nullTerminated"===g){var j=o;for(j;j<p.length&&0!==p[j];j++);var e=p.slice(o,j),i=f(e);o+=j-o+1,a=i}else{var k=v.read[g](p),d=o+b(p,k),e=p.slice(o,d),i=f(e);o+=d-o,a=i}return a}},HexString:function(a){var b;this.set=function(c){if(a=c,"string"==typeof a){if(-1===k.indexOf(a))throw new Error("Incorrect HexString size number type '"+a+"'.");b=!1}else if("number"==typeof a){if(a=Math.floor(a),0>a)throw new Error("HexString cannot have a fixed length shorter than 0.");b=!0}else throw new Error("Incorrect HexString size given.");return this},this.set(a),this.encode=function(d,e){if(0<d.length&&!c(d))throw new Error("Passed string is not a hex string.");if(!b)v.write[a](d.length,e);else if(d.length!==a)throw new Error("Passed string isn't of specified length "+a+".");for(var f=0;f<d.length;f+=2){var g=parseInt(d.charAt(f),16),h=parseInt(d.charAt(f+1)||0,16);e.push(g+16*h)}},this.decode=function(){var c=b?a:v.read[a](p);for(var d="",e=Math.ceil(c/2),f=0;f<e;f++){var g=p[o+f],h=g>>4;d+=(15&g).toString(16),f<e-1?d+=h.toString(16):0==c%2&&(d+=h.toString(16))}return o+=e,d}},Object:function(b,c){var d,e;this.set=function(f,g){if(b=f,c=g,void 0!==b){if(d=Object.keys(b),d.sort(),c){var h=Math.ceil(Math.log2(d.length)/8)||1;e=a(h)}return this}},this.set(b,c),this.encode=function(a,f){if(b===void 0)throw new Error("Can't encode, no blueprint defined.");if(!c)for(var g,h=0;h<d.length;h++){if(g=d[h],void 0===a[g])throw new Error("Key '"+g+"' is defined in the blueprint, but not in the input object.");b[g].encode(a[g],f)}else{for(var g,j=0,k={},h=0;h<d.length;h++)g=d[h],void 0===a[g]||(k[g]=h,j++);for(var g in v.write[e](j,f),k)v.write[e](k[g],f),b[g].encode(a[g],f)}},this.decode=function(){var a={};if(!c)for(var f,g=0;g<d.length;g++)f=d[g],a[f]=b[f].decode();else for(var f,h=v.read[e](p),g=0;g<h;g++)f=d[v.read[e](p)],a[f]=b[f].decode();return a}},Array:function(a,b){var c;this.set=function(d,e){if(a=d,b=e,void 0!==a){if("string"==typeof b){if(-1===k.indexOf(b))throw new Error("Incorrect Array size number type '"+b+"'.");c=!1}else if("number"==typeof b){if(b=Math.floor(b),0>b)throw new Error("Array cannot have a fixed length shorter than 0.");c=!0}else throw new Error("Incorrect Array size given.");return this}},this.set(a,b),this.encode=function(d,e){if(a===void 0)throw new Error("Can't encode, element not specified.");var f=d.length;if(!c)f>j[b]-1&&(d=d.slice(0,j[b]-1)),f=d.length,v.write[b](f,e);else if(f!==b)throw new Error("Passed array isn't of specified length "+b+".");for(var g=0;g<f;g++)a.encode(d[g],e)},this.decode=function(){var d,e=[];d=c?b:v.read[b](p);for(var f=0;f<d;f++)e.push(a.decode());return e}},Tuple:function(a){this.set=function(b){void 0===b||(a=b)},this.set(a),this.encode=function(b,c){if(a===void 0)throw new Error("Can't encode, no tuple specified.");if(b.length!==a.length)throw new Error("Given tuple values don't match the tuple's length of "+a.length+".");for(var d=0;d<a.length;d++)a[d].encode(b[d],c)},this.decode=function(){for(var b=[],c=0;c<a.length;c++)b.push(a[c].decode());return b}},Dynamic:function(b){var c,d;this.set=function(e){if(b=e,void 0!==b){c=Object.keys(b),c.sort();var f=Math.ceil(Math.log2(c.length)/8)||1;return d=a(f),this}},this.set(b),this.encode=function(a,e){if(b===void 0)throw new Error("Can't encode, no pairs object defined.");var f=a.key,g=a.value;if(b[f]===void 0)throw new Error("Key '"+f+"' is not defined.");v.write[d](c.indexOf(f),e),null!==b[f]&&b[f].encode(g,e)},this.decode=function(){var a=c[v.read[d](p)];return{key:a,value:null===b[a]?null:b[a].decode()}}},Enumerator:function(b,c){var d,e,f;this.set=function(g,h){if(b=g,c=h,void 0!==b){if(!c){d={},e=[];for(var j=0;j<b.length;j++)try{var k=JSON.stringify(b[j]);if(void 0===k)throw new Error("Enumerator "+b[j]+" serialized to 'undefined', that's bad.");d[k]=j,e.push(k)}catch(a){throw new Error("Enumerator "+b[j]+" couldn't be serialized.",a)}}var l=Math.ceil(Math.log2(b.length)/8)||1;return f=a(l),this}},this.set(b,c),this.encode=function(a,e){if(void 0===b)throw new Error("Can't encode, no enumeration defined.");var g;if(g=c?b.indexOf(a):d[JSON.stringify(a)],-1!==g&&void 0!==g)v.write[f](g,e);else throw new Error("Enumerator "+a+" not specified in enumeration.")},this.decode=function(){var a=v.read[f](p);return c?b[a]:JSON.parse(e[a])}},BitField:function(a){this.set=function(b){return a=b,this},this.encode=function(b,c){if(a===void 0)throw new Error("Can't encode, no attribute array defined.");for(var d=0,e=0;e<a.length;e++){0==e%8&&0<e&&(c.push(d),d=0);var f=a[e];if(b[f]!==void 0)!0===b[f]&&(d+=1<<e%8);else throw new Error("Attribute '"+f+"' is defined in the BitField, but no value was specified.")}a.length&&c.push(d)},this.decode=function(){for(var b={},c=0,d=p[o],e=0;e<a.length;e++)0==e%8&&0<e&&(c++,d=p[o+c]),b[a[e]]=0!=(d&1<<e%8);return o+=Math.floor(a.length/8),b}},NullWrapper:function(a){this.set=function(b){return a=b,this},this.encode=function(b,c){null===b||a===void 0?c.push(0):(c.push(1),a.encode(b,c))},this.decode=function(){var b=0===p[o++];return b?null:a.decode()}}},s=new ArrayBuffer(8),t=new Uint8Array(s),u=new DataView(s),v={write:{u8:function(a,b){u.setUint8(0,a,!0),b.push(t[0])},u16:function(a,b){u.setUint16(0,a,!0),b.push(t[0],t[1])},u24:function(a,c){a=b(Math.round(a),j.u24),u.setUint32(0,a,!0),c.push(t[0],t[1],t[2])},u32:function(a,b){u.setUint32(0,a,!0),b.push(t[0],t[1],t[2],t[3])},s8:function(a,b){u.setInt8(0,a,!0),b.push(t[0])},s16:function(a,b){u.setInt16(0,a,!0),b.push(t[0],t[1])},s24:function(a,c){a=b(Math.round(a)+j.s24,j.u24)-j.s24;var d=a;0>a&&(d=j.u24+a),u.setUint32(0,d,!0),c.push(t[0],t[1],t[2])},s32:function(a,b){u.setInt32(0,a,!0),b.push(t[0],t[1],t[2],t[3])},f32:function(a,b){u.setFloat32(0,a,!0),b.push(t[0],t[1],t[2],t[3])},f64:function(a,b){u.setFloat64(0,a,!0),b.push(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7])}},read:{u8:function(){var a=q.getUint8(o,!0);return o+=1,a},u16:function(){var a=q.getUint16(o,!0);return o+=2,a},u24:function(){t[0]=p[o],t[1]=p[o+1],t[2]=p[o+2],t[3]=0;var a=u.getUint32(0,!0);return o+=3,a},u32:function(){var a=q.getUint32(o,!0);return o+=4,a},s8:function(){var a=q.getInt8(o,!0);return o+=1,a},s16:function(){var a=q.getInt16(o,!0);return o+=2,a},s24:function(){var a=v.read.u24();return a>=j.s24?a-j.u24:a},s32:function(){var a=q.getInt32(o,!0);return o+=4,a},f32:function(){var a=q.getFloat32(o,!0);return o+=4,a},f64:function(){var a=q.getFloat64(o,!0);return o+=8,a}}};"object"==typeof module&&"object"==typeof module.exports?module.exports=r:"undefined"==typeof window?this.Binarify=r:window.Binarify=r})();