# Binarify Reference
In Binarify, Converter objects, which define a certain use-specific datatype or structure, have to be created first before any encoding/decoding can be performed.

All Converter objects come with these three core methods:

---
### Converter.encode(data)
Encodes the given data, which matches the previously defined datatype or structure, into a binary format, stored using the **UTF-8 encoding**. Each character encodes one byte ranging from 0-255. The format of `data` changes with Converter type.
### Converter.decode(string)
Decodes the given string, which was generated by encoding data through the same helper object, back into the previously defined datatype or structure. If no errors are made, this output will be exactly equal to the input passed to the `Converter.encode` method. So:
```javascript
Converter.decode(Converter.encode(data)) === data // if data matches the datatype of the Converter
```
### Converter.set(...args)
Taking the exact same arguments as the Converter's constructor, this method allows for the Converter to be configured after it's been instanciated. This can be used to dynamically change the protocol or to create circular/recursive data structures (more info further down).

# Converter types

There are different types of Converters, each built for their respective datatype/structure:

[Binarify.Boolean](#binarifyboolean)<br>
[Binarify.Number](#binarifynumber)<br>
[Binarify.String](#binarifystring)<br>
[Binarify.HexString](#binarifyhexstring)<br>
[Binarify.Object](#binarifyobject)<br>
[Binarify.Array](#binarifyarray)<br>
[Binarify.Dynamic](#binarifydynamic)<br>
[Binarify.SetElement](#binarifysetelement)<br>
[Binarify.BitField](#binarifybitfield)<br>
[Binarify.NullWrapper](#binarifynullwrapper)<br>

---
## Binarify.Boolean
Used for true/false values.<br>
### Instanciation syntax:
```javascript
new Binarify.Boolean()
```
### Encoding syntax:
```javascript
Converter.encode(boolean)
```
### Example:
```javascript
var bool = new Binarify.Boolean();
var encodedBool = bool.encode(4 < 7);
```

---
## Binarify.Number
Used for numbers of the specified bytetype.<br>
### Instanciation syntax:
```javascript
new Binarify.Number([type])
```
*Arguments:*<br>
- `type` - *Optional.* The bytetype which the number will be encoded in. Accepted values are **uByte**, **sByte**, **uShort**, **sShort**, **uTribyte**, **sTribyte**, **uInt**, **sInt**, **float** and **double**. Defaults to **double** if not set.
### Encoding syntax:
```javascript
Converter.encode(number)
```
### Example:
```javascript
var appleCount = new Binarify.Number("uShort");
var applesHarvested = appleCount.encode(7415);

var monthlyPay = new Binarify.Number("float");
var payInJune = monthlyPay.encode(5012.83);
```

---
## Binarify.String
Used for strings.
### Instanciation syntax:
```javascript
new Binarify.String([length])
```
*Arguments:*<br>
- `length` - *Optional.* Specifies the bytetype storing the length of the string. Accepted values are **byte**, **short**, **tribyte**, **int**, **float**, **double**, **nullTer** (null-terminated string with no length limit), **or** an integer (used to define a string with *fixed length*, resulting in saved bytes). Inputs longer than the possible storable length will be shortened. Defaults to **nullTer** if not set.
### Encoding syntax:
```javascript
Converter.encode(string)
```
### Example:
```javascript
var message = new Binarify.String("short"); // max length: 2^16 - 1
var encodedMessage = message.encode("The quick brown fox jumps over the lazy dog.");

var dateStr = new Binarify.String(10); // fixed length
var encodedDate = dateStr.encode("24-02-1955");
```

---
## Binarify.HexString
Used for hexadecimal strings. Stores them in about half the bytesize of what a regular string would require.
### Instanciation syntax:
```javascript
new Binarify.HexString([length])
```
*Arguments:*<br>
- `length` - *Optional.* Can be used to specify an exact length for the hex string (saves a few bytes).
### Encoding syntax:
```javascript
Converter.encode(hexString)
```
### Example:
```javascript
var SHA1 = new Binarify.HexString(40); // fixed length of 40
var encodedHash = SHA1.encode("74738ff55367e9589aee98fffdcd187694028007");
``` 

---
## Binarify.Object
Used for objects matching the predefined structure.
### Instanciation syntax:
```javascript
new Binarify.Object(blueprint[, loose])
```
*Arguments:*<br>
- `blueprint` - An object of key-value pairs where every value points to a *Converter* object.
- `loose` - *Optional.* Keys can be omitted if this is set to true. Otherwise, every key defined in the blueprint must also be present in the object passed to the `.encode()` method.
### Encoding syntax:
```javascript
Converter.encode(object)
// The structure of the passed object must match that specified within the blueprint.
```
### Example:
```javascript
var personBlueprint = new Binarify.Object({
    age: new Binarify.Number("uByte"),
    name: new Binarify.String(),
    isChild: new Binarify.Boolean()
});
var person = {
    age: 42,
    name: "John Doe",
    isChild: false
};
var encodedPerson = personBlueprint.encode(person);

// Circular structure using .set
var parentBlueprint = new Binarify.Object();
parentBlueprint.set({
    children: new Binarify.Array([parentBlueprint], 'byte')
});
var parent = {
    children: [{
        children: []
    }, {
        children: [{
            children: []
        }]
    }]
};
var encodedParent = parentBlueprint.encode(parent);
```

---
## Binarify.Array
Used for arrays matching the predefined pattern.
### Instanciation syntax:
```javascript
new Binarify.Array(pattern[, repeatSize])
```
*Arguments:*<br>
- `pattern` - An array containing *Converter* objects. The order of these objects will set the pattern for this array.
- `repeatSize` - *Optional.* Specifies the bytetype storing the amount of pattern repitions. Accepted values are **byte**, **short**, **tribyte**, **int**, **float**, **double** or an integer (used to define a *fixed amount* of pattern repetitions, resulting in saved bytes). If omitted, only inputs with the same array length as the pattern are accepted.
### Encoding syntax:
```javascript
Converter.encode(array)
// Array structure including its repeats must match the one specified within the pattern.
```
### Example:
```javascript
// Non-repeating
var firstAndLastNamePattern = new Binarify.Array([new Binarify.String(), new Binarify.String()]);
var firstAndLastName = ["John", "Doe"];
var encodedData = firstAndLastNamePattern.encode(firstAndLastName);

// Repeating (single element)
var randomIntegersPattern = new Binarify.Array([new Binarify.Number("sInt")], "int");
var randomIntegers = [4, 75, 34, -725, 142, 92];
var encodedData = randomIntegersPattern.encode(randomIntegers);
```

---
## Binarify.Dynamic
Used for cases in which the programmer can't predetermine or predict the required datatype/structure or where varying types are expected. All possible datatypes have to be predefined and named.
### Instanciation syntax:
```javascript
new Binarify.Dynamic(pairs)
```
*Arguments:*<br>
- `pairs` - An associative object, where every key points to a Converter object which will define the datatype for that specific key.
### Encoding syntax:
```javascript
Converter.encode({key: desiredKey, value: dataToEncode});
/* Desired key has to be a key of the specified pairs object, and the structure of
   that key's value has to match that of dataToEncode. */
   
Converter.encode(desiredKey, dataToEncode);
/* Alternative, cleaner way of passing key and value. Only works when the Dynamic Converter
   is at the top-most layer of the data structure. */
```
### Example:
```javascript
var chairBlueprint = new Binarify.Object({height: new Binarify.Number("float")}),
    tableBlueprint = new Binarify.Object({area: new Binarify.Number("float")}),
    lampBlueprint = new Binarify.Object({color: new Binarify.String()});
    
var furnitureArray = new Binarify.Array([new Binarify.Dynamic({
    chair: chairBlueprint,
    table: tableBlueprint,
    lamp: lampBlueprint
})], "byte");

var encodedData = furnitureArray.encode([
    {key: "chair", value: {height: 0.73}},
    {key: "chair", value: {height: 0.25}},
    {key: "lamp", value: {color: "orange"}},
    {key: "table", value: {area: 2.125}},
    {key: "lamp", value: {color: "white"}}
]);
```
Instead of assigning a key to a Converter, one can also assign it to `null`. This is useful for when the key itself carries meaning and doesn't actually need to hold any additional data.
```javascript
var messageTypes = new Binarify.Dynamic({
    sayHi: null,
    sayNumber: new Binarify.Number()
});

function handleMessage(msg) {
    if (msg.key === "sayHi") console.log("Hi");
    if (msg.key === "sayNumber") console.log(msg.value);
}
handleMessage(messageTypes.decode(messageTypes.encode({key: "sayHi" /* 'value' does not need to be specified in this case */})));
```

---
## Binarify.SetElement
Used to encode a reference to an element of a predefined set. Good if you know the value can only be a few things.
### Instanciation syntax:
```javascript
new Binarify.SetElement(elements[, noSerialization])
```
*Arguments:*<br>
- `elements` - An array specifying all the possible elements. The element has to be serializable if `noSerialization` isn't `true`.
- `noSerialization` - *Optional.* If set to `true`, elements in the `elements` array won't be serialized. This means you can encode almost everything, but will result in the direct reference to the variable being returned by `decode()` - meaning it can be changed locally and will thus differ from all parties involved. Only use if you know what you're doing, or if you want to pass functions or read-only objects. Defaults to `false`.
### Encoding syntax:
```javascript
Converter.encode(element) // element must be contained in set
```
### Example:
```javascript
var elem = new Binarify.SetElement(["a", "b", "c", true, Math.PI, {foo: "bar"}, [0, 1, 2]]);

// These all work
elem.decode(elem.encode("a"));
elem.decode(elem.encode("b"));
elem.decode(elem.encode("c"));
elem.decode(elem.encode(true));
elem.decode(elem.encode(Math.PI));
elem.decode(elem.encode({foo: "bar"}));
elem.decode(elem.encode([0, 1, 2]));

// These don't work
elem.decode(elem.encode(Math.E));
elem.decode(elem.encode({name: "John Doe"}));

/* Example for no serialization: */
var referenceElem = new Binarify.SetElement([Math, setInterval], true);

referenceElem.decode(referenceElem.encode(Math)).sqrt(25); // => 5
```

---
## Binarify.BitField
Used to encode a boolean [bit field](https://en.wikipedia.org/wiki/Bit_field). This is great if you need to encode many booleans in a group.
###
```javascript
new Binarify.BitField(attributes)
```
*Arguments:*<br>
- `attributes` - An array specifying all attributes of the bit field.
### Encoding syntax:
```javascript
Converter.encode(field) // An object where each key is an attribute and has a value of true/false.
```
### Example:
```javascript
var drinkProperties = new Binarify.BitField(["isCold", "isAlcoholic", "isSparkling", "isSweet"]);

var encodedCoke = drinkProperties.encode({
    isCold: true,
    isAlcoholic: false,
    isSparkling: true,
    isSweet: true
}); // This bitfield will be '1011'
```

---
## Binarify.NullWrapper
Used for cases where null might be passed to the converter, instead of the specified data structure.
### Instanciation syntax:
```javascript
new Binarify.NullWrapper(converterObject)
```
*Arguments:*<br>
- `converterObject` - Any Converter object. Will be used to encode the data if it isn't null. **This argument can technically be omitted**, but then the Converter will simply convert everything to null, and only to null.
### Encoding syntax:
```javascript
Converter.encode(data);
```
### Example:
```javascript
var clientDataBlueprint = new Binarify.Object({
    firstName: new Binarify.String(),
    lastName: new Binarify.String(),
    email: new Binarify.String(),
    dateOfBirth: new Binarify.NullWrapper(new Binarify.Number("uInt")), // This...
    phoneNumber: new Binarify.NullWrapper(new Binarify.String()) // ...and this field might be optional
});

var encodedData = clientDataBlueprint.encode({
    firstName: "John",
    lastName: "Doe",
    email: "john.doe@example.com",
    dateOfBirth: null,
    phoneNumber: "123 456 789"
});
```
